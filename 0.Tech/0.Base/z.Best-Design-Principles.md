# 最佳设计原则

总结软件设计、信息化最佳实践

## SOLID

SOLID

## 客户端服务端

客户端：设置超时。所有网络调用都需要，如数据库访问，第三方 API 接口；数据库，RESTAPI 都有设置超时的方法
重要调用重试，大面积故障时调用降级（重试也降级）

服务端：设置限流。google.guava 包有限流的 API；调用方降级；

白名单（如测试）/黑名单机制：IP、接口业务实现

请求响应的 view 分成三类：
1、监控请求，成功失败都不提示，可以打 log 方便查日志；
2、业务成功或业务客户端导致的异常，显示错误码及错误原因；4xxxx
3、业务服务器失败，只提示错误码，及统一错误信息，服务器返回的错误描述不显示，log 可以输出；41xxx，5xxxx

微服务/第三方服务：
注册与发现；熔断、降级、限流

## 开发阶段考虑 UAT 测试

- 上线后如何进行 UAT 测试，测试期间新特征不影响正常用户
- 涉及金钱的测试订单，标记数据状态（实际未付钱的）

## 简单的数据处理

## ebay 

第一点就是做分割，对任何东西都应进行分割，如果不能够分割就不能扩展。

第二个最佳实践就是，尽量使用非同步性。

第三就是要把每件事情都自动化。

第四点就是要记住每件事情都有可能出现故障。

最后一点就是说我们要拥抱不一致性，因为我们希望给我们自己一个自由，就是可以我们最终实现一致性，但是在过程当中不一定实现及时的一致性。谢谢！



## 分库分表

业务表：ID，a1,a2,a3
a1,a2 唯一
a1,a3 唯一
约束表 M，a1,a2 id	(利用索引保证数据唯一性)
约束表 N，a1,a3 id

（分库事务，补偿操作）


新增，如果有字段需要唯一约束，可以额外建关联表。可以提前查是否已经存在（悲观锁 - 约束异常或乐观锁 - 业务未完成）。
更新，更新前查出来的，需要锁住，或者是以乐观锁的机制更新（重试）。
TCC 模式。取资源，事务，如业务未完成资源回退。

日新增 100 w，中途增加库。每个库中分表的数量固定


## 热力图

事件分析热力图

## 大数据

数据量级：GB TB PB

大数据分析两种解决方案：
Greenplum（MPP）和 Hadoop（HDFS和MapReduce）

redshift 基于 Greenplum

拉链表？